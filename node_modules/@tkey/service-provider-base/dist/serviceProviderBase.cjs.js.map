{"version":3,"file":"serviceProviderBase.cjs.js","mappings":"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","sources":["webpack://@tkey/service-provider-base/webpack/bootstrap","webpack://@tkey/service-provider-base/webpack/runtime/compat get default export","webpack://@tkey/service-provider-base/webpack/runtime/define property getters","webpack://@tkey/service-provider-base/webpack/runtime/hasOwnProperty shorthand","webpack://@tkey/service-provider-base/webpack/runtime/make namespace object","webpack://@tkey/service-provider-base/external commonjs2 \"@babel/runtime/helpers/asyncToGenerator\"","webpack://@tkey/service-provider-base/external commonjs2 \"@babel/runtime/helpers/classCallCheck\"","webpack://@tkey/service-provider-base/external commonjs2 \"@babel/runtime/helpers/createClass\"","webpack://@tkey/service-provider-base/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@tkey/service-provider-base/external commonjs2 \"@babel/runtime/regenerator\"","webpack://@tkey/service-provider-base/external commonjs2 \"@tkey/common-types\"","webpack://@tkey/service-provider-base/external commonjs2 \"bn.js\"","webpack://@tkey/service-provider-base/./src/ServiceProviderBase.ts","webpack://@tkey/service-provider-base/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/asyncToGenerator\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/classCallCheck\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/createClass\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/regenerator\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@tkey/common-types\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"bn.js\");","import {\n  BNString,\n  decrypt as decryptUtils,\n  encrypt as encryptUtils,\n  EncryptedMessage,\n  getPubKeyECC,\n  IServiceProvider,\n  PubKeyType,\n  ServiceProviderArgs,\n  StringifiedType,\n  toPrivKeyEC,\n  toPrivKeyECC,\n} from \"@tkey/common-types\";\nimport BN from \"bn.js\";\nimport { curve } from \"elliptic\";\n\nclass ServiceProviderBase implements IServiceProvider {\n  enableLogging: boolean;\n\n  // For easy serialization\n  postboxKey: BN;\n\n  serviceProviderName: string;\n\n  constructor({ enableLogging = false, postboxKey }: ServiceProviderArgs) {\n    this.enableLogging = enableLogging;\n    this.postboxKey = new BN(postboxKey, \"hex\");\n    this.serviceProviderName = \"ServiceProviderBase\";\n  }\n\n  static fromJSON(value: StringifiedType): IServiceProvider {\n    const { enableLogging, postboxKey, serviceProviderName } = value;\n    if (serviceProviderName !== \"ServiceProviderBase\") return undefined;\n\n    return new ServiceProviderBase({ enableLogging, postboxKey });\n  }\n\n  async encrypt(msg: Buffer): Promise<EncryptedMessage> {\n    const publicKey = this.retrievePubKey(\"ecc\");\n    return encryptUtils(publicKey, msg);\n  }\n\n  async decrypt(msg: EncryptedMessage): Promise<Buffer> {\n    return decryptUtils(toPrivKeyECC(this.postboxKey), msg);\n  }\n\n  retrievePubKeyPoint(): curve.base.BasePoint {\n    return toPrivKeyEC(this.postboxKey).getPublic();\n  }\n\n  retrievePubKey(type: PubKeyType): Buffer {\n    if (type === \"ecc\") {\n      return getPubKeyECC(this.postboxKey);\n    }\n    throw new Error(\"Unsupported pub key type\");\n  }\n\n  sign(msg: BNString): string {\n    const tmp = new BN(msg, \"hex\");\n    const sig = toPrivKeyEC(this.postboxKey).sign(tmp.toString(\"hex\"));\n    return Buffer.from(sig.r.toString(16, 64) + sig.s.toString(16, 64) + new BN(0).toString(16, 2), \"hex\").toString(\"base64\");\n  }\n\n  toJSON(): StringifiedType {\n    return {\n      enableLogging: this.enableLogging,\n      postboxKey: this.postboxKey.toString(\"hex\"),\n      serviceProviderName: this.serviceProviderName,\n    };\n  }\n}\n\nexport default ServiceProviderBase;\n","export { default, default as ServiceProviderBase } from \"./ServiceProviderBase\";\n"],"names":["decrypt","decryptUtils","encrypt","encryptUtils","getPubKeyECC","toPrivKeyEC","toPrivKeyECC","BN","ServiceProviderBase","enableLogging","postboxKey","serviceProviderName","msg","publicKey","retrievePubKey","getPublic","type","Error","tmp","sig","sign","toString","Buffer","from","r","s","value","undefined","default"],"sourceRoot":""}